# streaminginstability
Research code for upcoming paper on lunar formation via the streaming instability. 
All code is meant to work on the output of Athena, which can be found at 
https://princetonuniversity.github.io/Athena-Cversion/.  
This is, of course, not the *entirety* of the code used for the project, but it's what
I'm using the majority of the time for now.
Nothing here is guaranteed to work 100%: keep your bug swatter handy.

## Included files
All runnable scripts can be run with `-h` or `--help` to print usage

plotutils.py: general function utility file, not runnable

calcsurfdens.py: calculates the surface density at all points for 2D (parallelized) simulation data

carrera.py: outputs plots inspired by (or other info related to) figure A1 from Carrera et. al. 2015

abod_mass.py: calculates predicted mass of planetesimals from overdensities as in Abod et. al. 2019

spacetime.py: calculates space vs. time vs. particle density colorplots

## Workflow
The first thing to do, before doing any direct analysis work, is to run calcsurfdens.py. 
This is the part that can take some time. Then the output file is fed into the other
analysis routines, which are much faster.

## Documentation
calcsurfdens.py outputs a file containing surface density information over a range of timesteps.
```
python calcsurfdens.py simfolder savepath x1_blocks x2_blocks 
    [--tmin tmin] [--tmax tmax] [--dt dt] [--posfile posfile]
```
Arguments:
* `simfolder`: Path to folder containing id folders
* `savepath`: Name of output csv file
* `x1_blocks`: Number of blocks in the x1 direction
* `x2_blocks`: Number of blocks in the x2 direction
* `tmin`: Starting tabfile index, default 0
* `tmax`: Final tabfile index, default is highest one present
* `dt`: Number of time steps between each tabfile output, default 1
* `posfile`: Output a csv containing the position of density values along the x1 axis

abod_mass.py calculates the mass of the largest lunar seed formed, as in Abod et. al. 2019,
by using the peak surface density.

```
python abod_mass.py surfdenscsv [--plotdir plotdir] [--posfile posfile] [--timestep timestep]
```
Arguments:
* `surfdenscsv`: Location of surface density csv file (as output by calcsurfdens.py)
* `plotdir`: Directory to save plots, default is to not do so. Requires --posfile
* `posfile`: Location of x positions csv file
* `timestep`: Timestep to compute mass for, default is the last one

carrera.py outputs plots & performs analysis similar to that in Appendix A1 of Carrera et. al. 2015
```
python carrera.py surfdenscsv windowsize [--start_t start_t] [--plots plots] [--posfile posfile]
```
Arguments:
* `surfdenscsv`: Location of surface density csv file (as output by calcsurfdens.py)
* `windowsize`: Size of the averaging window in timesteps
* `start_t`: Starting time step for averaging window, default is first in
the surface density csv. -1 sets the window to the latest possible section
* `plots`: Output plots in the given location for each of the steps, as in 
figure A1. Requres a specified position file.
* `posfile`: CSV with position information, generated by calcsurfdens.py
